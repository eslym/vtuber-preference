import{S as se,i as ie,s as oe,d as q,f as N,g as z,t as M,h as U,j as V,k as b,l as J,n as P,m as F,r as ze,o as it,v as Ge,C as pe,w as xe,x as j,y as ot,z as ee,A as R,B as Me,D,E as ft,F as te,G as ve,H as y,I as E,J as Q,K as qe,L as $e,M as fe,N as ne,O as re,P as We,Q as ce,R as at,T as me,U as Ce,V as G,W as be,X as ke,Y as ye,Z as Le,_ as ut,$ as dt,a0 as ct,a1 as gt,a2 as ht,a3 as pt,a4 as mt,a5 as et,a6 as _t,a7 as wt,a8 as _e,a9 as bt}from"./chunk-32b5f034.js";import{S as ue,b as ge,R as he,c as x,d as we,C as tt,M as kt,e as Te,f as yt,g as At,i as Se,E as St,s as nt,j as zt,k as vt}from"./chunk-f289833c.js";import"./chunk-28e086c5.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function r(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerpolicy&&(l.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?l.credentials="include":s.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(s){if(s.ep)return;s.ep=!0;const l=r(s);fetch(s.href,l)}})();function Ct(n){let e,r,t,s,l,o,a,f,i,u,m,c,S,p,L,g,h,A,_,v,B,W,C;return{c(){e=q("div"),r=q("div"),t=q("div"),s=N(),l=q("div"),o=N(),a=q("div"),f=N(),i=q("div"),u=q("div"),m=N(),c=q("div"),S=N(),p=q("div"),L=N(),g=q("div"),h=q("div"),A=N(),_=q("div"),v=N(),B=q("div"),z(t,"class","resizer h-[6px] w-[6px] rounded-sm border-2 svelte-19ac299"),M(t,"cursor-nw-resize",!n[4]),M(t,"dragging",n[4]&&n[5]===n[15]),z(l,"class","resizer h-[6px] border-b-2 border-dashed svelte-19ac299"),U(l,"width",n[2]+"px"),M(l,"cursor-n-resize",!n[4]),M(l,"dragging",n[4]&&n[5]===n[13]),z(a,"class","resizer h-[6px] w-[6px] rounded-sm border-2 svelte-19ac299"),M(a,"cursor-ne-resize",!n[4]),M(a,"dragging",n[4]&&n[5]===n[16]),z(r,"class","flex flex-row"),z(u,"class","resizer w-[6px] border-r-2 border-dashed svelte-19ac299"),U(u,"height",n[3]+"px"),M(u,"cursor-w-resize",!n[4]),M(u,"dragging",n[4]&&n[5]===n[12]),z(c,"class","cursor-move"),U(c,"width",n[2]+"px"),U(c,"height",n[3]+"px"),z(p,"class","resizer w-[6px] border-l-2 border-dashed svelte-19ac299"),U(p,"height",n[3]+"px"),M(p,"cursor-e-resize",!n[4]),M(p,"dragging",n[4]&&n[5]===n[10]),z(i,"class","flex flex-row"),z(h,"class","resizer h-[6px] w-[6px] rounded-sm border-2 svelte-19ac299"),M(h,"cursor-sw-resize",!n[4]),M(h,"dragging",n[4]&&n[5]===n[17]),z(_,"class","resizer h-[6px] border-t-2 border-dashed svelte-19ac299"),U(_,"width",n[2]+"px"),M(_,"cursor-s-resize",!n[4]),M(_,"dragging",n[4]&&n[5]===n[11]),z(B,"class","resizer h-[6px] w-[6px] rounded-sm border-2 svelte-19ac299"),M(B,"cursor-se-resize",!n[4]),M(B,"dragging",n[4]&&n[5]===n[14]),z(g,"class","flex flex-row"),z(e,"class","this svelte-19ac299"),U(e,"left",n[0]-6+"px"),U(e,"top",n[1]-6+"px"),U(e,"width",n[2]+12+"px"),U(e,"height",n[3]+12+"px"),M(e,"dragging",!!n[4])},m(d,w){V(d,e,w),b(e,r),b(r,t),b(r,s),b(r,l),b(r,o),b(r,a),b(e,f),b(e,i),b(i,u),b(i,m),b(i,c),b(i,S),b(i,p),b(e,L),b(e,g),b(g,h),b(g,A),b(g,_),b(g,v),b(g,B),W||(C=[J(window,"mouseup",n[19]),J(window,"mousemove",n[8]),J(t,"mousedown",n[20]),J(l,"mousedown",n[21]),J(a,"mousedown",n[22]),J(u,"mousedown",n[23]),J(c,"mousedown",n[24]),J(p,"mousedown",n[25]),J(h,"mousedown",n[26]),J(_,"mousedown",n[27]),J(B,"mousedown",n[28])],W=!0)},p(d,[w]){w&16&&M(t,"cursor-nw-resize",!d[4]),w&32816&&M(t,"dragging",d[4]&&d[5]===d[15]),w&4&&U(l,"width",d[2]+"px"),w&16&&M(l,"cursor-n-resize",!d[4]),w&8240&&M(l,"dragging",d[4]&&d[5]===d[13]),w&16&&M(a,"cursor-ne-resize",!d[4]),w&65584&&M(a,"dragging",d[4]&&d[5]===d[16]),w&8&&U(u,"height",d[3]+"px"),w&16&&M(u,"cursor-w-resize",!d[4]),w&4144&&M(u,"dragging",d[4]&&d[5]===d[12]),w&4&&U(c,"width",d[2]+"px"),w&8&&U(c,"height",d[3]+"px"),w&8&&U(p,"height",d[3]+"px"),w&16&&M(p,"cursor-e-resize",!d[4]),w&1072&&M(p,"dragging",d[4]&&d[5]===d[10]),w&16&&M(h,"cursor-sw-resize",!d[4]),w&131120&&M(h,"dragging",d[4]&&d[5]===d[17]),w&4&&U(_,"width",d[2]+"px"),w&16&&M(_,"cursor-s-resize",!d[4]),w&2096&&M(_,"dragging",d[4]&&d[5]===d[11]),w&16&&M(B,"cursor-se-resize",!d[4]),w&16432&&M(B,"dragging",d[4]&&d[5]===d[14]),w&1&&U(e,"left",d[0]-6+"px"),w&2&&U(e,"top",d[1]-6+"px"),w&4&&U(e,"width",d[2]+12+"px"),w&8&&U(e,"height",d[3]+12+"px"),w&16&&M(e,"dragging",!!d[4])},i:P,o:P,d(d){d&&F(e),W=!1,ze(C)}}}function Et(n,e,r){let{x:t}=e,{y:s}=e,{width:l}=e,{height:o}=e,{ratio:a=l/o}=e,f,i=()=>{},u="",m=it();function c(k,O,K){k.preventDefault(),r(4,f=k.target),r(5,i=O),r(6,u=K),document.body.classList.add(K)}function S(k){f&&(i({x:k.clientX,y:k.clientY}),m("update",{pos:{x:t,y:s},rect:{width:l,height:o}}))}function p(k){k.preventDefault(),r(4,f=k.target);let O=k.offsetX,K=k.offsetY;r(5,i=X=>{let Z=f.getBoundingClientRect(),le=X.x-(Z.x+O),ae=X.y-(Z.y+K);r(0,t+=le),r(1,s+=ae)})}function L(k,O=!1){let K=f.getBoundingClientRect(),X=k.x-(K.x+1+K.width/2),Z=Math.max(l+(O?-X:X),0),le=Math.max(Z/a,0),ae=(le-o)/2;r(2,l=Z),r(3,o=le),r(1,s-=ae)}function g(k,O=!1){let K=f.getBoundingClientRect(),X=k.y-(K.y+K.height/2),Z=Math.max(o+(O?-X:X),0),le=Math.max(Z*a,0),ae=(le-l)/2;r(2,l=le),r(3,o=Z),r(0,t-=ae)}function h(k){let O=l;L(k,!0),r(0,t-=l-O)}function A(k){let O=o;g(k,!0),r(1,s-=o-O)}function _(k,O={}){let K=f.getBoundingClientRect(),X=(k.x-(K.x+K.width/2))*(O.x?-1:1),Z=(k.y-(K.y+K.height/2))*(O.y?-1:1),le=Math.abs(X)<Math.abs(Z)?X:Z,ae=Math.min(Math.abs(X)/Math.max(l,1),Math.abs(Z)/Math.max(o,1)),Ie=Math.max(l+Math.max(l,1)*ae*(le<0?-1:1),0);r(3,o=Math.max(Ie/a,0)),r(2,l=Ie)}function v(k){let O={width:l,height:o};_(k,{x:!0,y:!0}),r(0,t-=l-O.width),r(1,s-=o-O.height)}function B(k){let O=o;_(k,{y:!0}),r(1,s-=o-O)}function W(k){let O=l;_(k,{x:!0}),r(0,t-=l-O)}const C=()=>{r(4,f=void 0),u.length&&document.body.classList.remove(u)},d=k=>c(k,v,"cursor-nw-resize"),w=k=>c(k,A,"cursor-n-resize"),I=k=>c(k,B,"cursor-ne-resize"),H=k=>c(k,h,"cursor-w-resize"),de=k=>p(k),T=k=>c(k,L,"cursor-e-resize"),Y=k=>c(k,W,"cursor-sw-resize"),$=k=>c(k,g,"cursor-s-resize"),st=k=>c(k,_,"cursor-se-resize");return n.$$set=k=>{"x"in k&&r(0,t=k.x),"y"in k&&r(1,s=k.y),"width"in k&&r(2,l=k.width),"height"in k&&r(3,o=k.height),"ratio"in k&&r(18,a=k.ratio)},[t,s,l,o,f,i,u,c,S,p,L,g,h,A,_,v,B,W,a,C,d,w,I,H,de,T,Y,$,st]}class It extends se{constructor(e){super(),ie(this,e,Et,Ct,oe,{x:0,y:1,width:2,height:3,ratio:18})}}const rt="/assets/png-847a4edb.png",Ee="data:image/png;base64,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",lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG8AAAAbCAYAAABydtG3AAABbmlDQ1BpY2MAACiRdZFLSwJhFIYftShKcVFQRAsXFhEKURAtwyA31kINstqM4y3wMswoIW2DNi2EFlGbbov+QW2DtgVBUAQR7dp324RMZ1RQQs/wzXl4v/MezpwBeyir5oyuecjli3o4GPCsxtY8Pe/YGcLGJC5FNbSlyGKUjvHzKJUSD36rV+e6ttGfSBoq2HqFZ1VNLwrLNIS2iprFe8KDakZJCJ8I+3QZUPjW0uN1frM4Xecvi/VoeAHsVk9PuoXjLaxm9JzwhLA3ly2pjXmsL3Em8ysRySNyRjEIEySAhzglNslSxC85Lztr75uq+ZYpiEeVt0YZXRxpMuL1iVqSrknJKdGT8mQpW3v/v08jNTNd7+4MQPeraX6OQc8+VCum+XtqmtUzcLzAdb7pL8ie5r5FrzQ17zG4d+DypqnFD+BqF4afNUVXapJDjj2Vgo8LcMVg4B761uu7atxz/gTRbflFd3B4BONS7974A/7qaAncN4wDAAAACXBIWXMAAC4jAAAuIwF4pT92AAABLklEQVRo3u2ZoQ7CMBRF2ymCYw5w4LDwCfALSD4BjcQi4TewOCx2cjgmsZObK7fQErJsQEiAveSe5NFsI4h70u6VamNMWyk1VkQcGvL2lCeTAJUyBrnyCOURyiOUR3mE8sj35GWMQa68nDHIlZcwBrnyIsYgkkzbTwOYhTgSdptyib08dpzy2Pllk8dCwtAWJ6+H4cRIxJBCXRg4iwmXTlEsr978FWbfHMOauchYMv0+z9/YKJ6qS2B2d1Z8wj1frYkwyUb+omyfN2JG9dyUP4orlYcvRG5NZQNTH7ZQ0i/eDJ68FJsYVsztr5xRIVxMyx4GL7qahZuFE9SBWf5mD+e6fht9F1XZROpPfh09zVDd/pEZoDqoFqrB3N8md68lK+aIiu3SqApnq25HUMkF9iA+fiYIrQ4AAAAASUVORK5CYII=";function Mt(n){let e,r,t,s,l,o,a;return{c(){e=q("label"),r=q("div"),t=Ge(n[2]),s=N(),l=q("span"),o=N(),a=q("input"),z(r,"class","w-0 flex-grow"),z(l,"class","inline-block h-6 w-6 rounded-full border-2 shadow "),U(l,"background-color",n[1]),M(l,"border-white",pe(n[1]).isDark()),M(l,"border-black",pe(n[1]).isLight()),z(a,"type","hidden"),z(e,"class","flex cursor-pointer flex-row items-center gap-2 py-2 px-4 hover:bg-gray-300"),M(e,"bg-gray-300",n[3])},m(f,i){V(f,e,i),b(e,r),b(r,t),b(e,s),b(e,l),b(e,o),b(e,a),n[4](e)},p(f,[i]){i&4&&xe(t,f[2]),i&2&&U(l,"background-color",f[1]),i&2&&M(l,"border-white",pe(f[1]).isDark()),i&2&&M(l,"border-black",pe(f[1]).isLight()),i&8&&M(e,"bg-gray-300",f[3])},i:P,o:P,d(f){f&&F(e),n[4](null)}}}function qt(n,e,r){let{hex:t}=e,{label:s}=e,{isOpen:l}=e,{labelWrapper:o}=e;function a(f){j[f?"unshift":"push"](()=>{o=f,r(0,o)})}return n.$$set=f=>{"hex"in f&&r(1,t=f.hex),"label"in f&&r(2,s=f.label),"isOpen"in f&&r(3,l=f.isOpen),"labelWrapper"in f&&r(0,o=f.labelWrapper)},[o,t,s,l,a]}class Wt extends se{constructor(e){super(),ie(this,e,qt,Mt,oe,{hex:1,label:2,isOpen:3,labelWrapper:0})}}function Ue(n,e,r){const t=n.slice();return t[21]=e[r],t[23]=r,t}function Ne(n,e){let r,t,s,l,o,a,f,i=e[21].name+"",u,m,c,S,p;function L(..._){return e[15](e[23],..._)}function g(){return e[17](e[21],e[23])}function h(){return e[18](e[23])}function A(..._){return e[19](e[23],..._)}return{key:n,first:null,c(){r=q("div"),t=q("div"),s=q("img"),a=N(),f=q("div"),u=Ge(i),m=N(),c=q("button"),c.textContent="Ｘ",z(s,"draggable","false"),z(s,"alt",l=e[21].name),qe(s.src,o=e[21].image.src)||z(s,"src",o),z(s,"class","h-10 w-10 object-cover"),z(f,"class","w-0 flex-grow overflow-hidden whitespace-nowrap"),z(t,"class","flex w-0 flex-grow items-center gap-2 overflow-hidden"),z(t,"draggable","true"),z(c,"class","h-10 w-10 bg-slate-500 font-bold text-white"),z(r,"class","flex select-none flex-row items-center gap-4"),M(r,"bg-slate-300",e[1]===e[23]),this.first=r},m(_,v){V(_,r,v),b(r,t),b(t,s),b(t,a),b(t,f),b(f,u),b(r,m),b(r,c),S||(p=[J(t,"dragstart",L),J(t,"dragend",e[16]),J(c,"click",g),J(r,"mousedown",h),J(r,"dragover",A)],S=!0)},p(_,v){e=_,v&1&&l!==(l=e[21].name)&&z(s,"alt",l),v&1&&!qe(s.src,o=e[21].image.src)&&z(s,"src",o),v&1&&i!==(i=e[21].name+"")&&xe(u,i),v&3&&M(r,"bg-slate-300",e[1]===e[23])},d(_){_&&F(r),S=!1,ze(p)}}}function Lt(n){let e,r,t,s,l,o,a,f,i,u,m,c,S,p,L,g,h,A=[],_=new Map,v,B,W,C,d;function w(T){n[12](T)}let I={isAlpha:!1,label:"背景色",components:{input:Wt}};n[0].background!==void 0&&(I.hex=n[0].background),m=new ot({props:I}),j.push(()=>ee(m,"hex",w));let H=n[0].layers;const de=T=>T[21].image;for(let T=0;T<H.length;T+=1){let Y=Ue(n,H,T),$=de(Y);_.set($,A[T]=Ne($,Y))}return{c(){e=q("div"),r=q("div"),t=q("button"),t.textContent="＜",s=N(),l=q("input"),a=N(),f=q("button"),f.textContent="＞",i=N(),u=q("div"),R(m.$$.fragment),S=N(),p=q("div"),L=q("form"),g=q("input"),h=N();for(let T=0;T<A.length;T+=1)A[T].c();v=N(),B=q("button"),B.textContent="添加圖片",z(t,"class","p-2"),z(l,"class","w-0 flex-grow bg-transparent py-2 px-4 font-normal text-slate-100 underline-offset-4 placeholder:text-slate-300 focus:outline-none"),z(l,"placeholder",o=n[0].name),z(f,"class","p-2"),z(r,"class","flex flex-row items-center bg-slate-600 text-xl font-bold text-white"),z(g,"type","file"),z(g,"accept",".jpg,.jpeg,.png,.bmp,.webp"),z(L,"class","hidden"),z(B,"class","block p-0.5 hover:bg-gray-300 active:bg-gray-200"),z(p,"class","flex h-0 flex-grow flex-col gap-2 p-4"),z(e,"class","flex h-full w-full flex-col bg-gray-100")},m(T,Y){V(T,e,Y),b(e,r),b(r,t),b(r,s),b(r,l),Me(l,n[0].dynamic),b(r,a),b(r,f),b(e,i),b(e,u),D(m,u,null),b(e,S),b(e,p),b(p,L),b(L,g),n[13](g),n[14](L),b(p,h);for(let $=0;$<A.length;$+=1)A[$].m(p,null);b(p,v),b(p,B),W=!0,C||(d=[J(t,"click",n[9]),J(l,"input",n[10]),J(f,"click",n[11]),J(g,"change",n[6]),J(B,"click",ft(n[20]))],C=!0)},p(T,[Y]){(!W||Y&1&&o!==(o=T[0].name))&&z(l,"placeholder",o),Y&1&&l.value!==T[0].dynamic&&Me(l,T[0].dynamic);const $={};!c&&Y&1&&(c=!0,$.hex=T[0].background,te(()=>c=!1)),m.$set($),Y&419&&(H=T[0].layers,A=ve(A,Y,de,1,T,H,_,p,$e,Ne,v,Ue))},i(T){W||(y(m.$$.fragment,T),W=!0)},o(T){E(m.$$.fragment,T),W=!1},d(T){T&&F(e),Q(m),n[13](null),n[14](null);for(let Y=0;Y<A.length;Y+=1)A[Y].d();C=!1,ze(d)}}}function Tt(n,e,r){let{slot:t}=e,{selectedLayer:s}=e,{selectedSlot:l}=e,o,a;function f(){let d=o.files[0],w=new FileReader;w.onload=()=>{let I=new Image;I.onload=()=>{let H={width:I.width,height:I.height};if(I.width>I.height){if(I.width>512){let T=I.width/512;H.width/=T,H.height/=T}}else if(I.height>512){let T=I.height/512;H.width/=T,H.height/=T}let de={name:d.name,image:I,pos:{x:56-H.width/2,y:80-H.height/2},rect:H};r(1,s=0),r(0,t.layers=[de,...t.layers],t)},I.src=w.result},w.readAsDataURL(d),a.reset()}let i=!1;function u(d,w){r(5,i=w);let I=d.target.parentElement;d.dataTransfer.dropEffect="move",d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("text/plain",t.layers[w].name),d.dataTransfer.setDragImage(I,I.clientWidth/2,I.clientHeight/2)}function m(d,w){if(i===!1)return;d.preventDefault();let I=t.layers[i],H=t.layers[w];r(0,t.layers[w]=I,t),r(0,t.layers[i]=H,t),r(5,i=w),d.dataTransfer.dropEffect="move",r(1,s=w)}const c=()=>{r(2,l=(15+l-1)%15),r(1,s=void 0)};function S(){t.dynamic=this.value,r(0,t)}const p=()=>{r(2,l=(l+1)%15),r(1,s=void 0)};function L(d){n.$$.not_equal(t.background,d)&&(t.background=d,r(0,t))}function g(d){j[d?"unshift":"push"](()=>{o=d,r(3,o)})}function h(d){j[d?"unshift":"push"](()=>{a=d,r(4,a)})}const A=(d,w)=>u(w,d),_=()=>{r(5,i=!1)},v=(d,w)=>{r(0,t.layers=t.layers.filter(I=>I!==d),t),r(1,s=s>w?s-1:s<w?s:void 0)},B=d=>r(1,s=d),W=(d,w)=>m(w,d),C=()=>o.click();return n.$$set=d=>{"slot"in d&&r(0,t=d.slot),"selectedLayer"in d&&r(1,s=d.selectedLayer),"selectedSlot"in d&&r(2,l=d.selectedSlot)},[t,s,l,o,a,i,f,u,m,c,S,p,L,g,h,A,_,v,B,W,C]}class Ut extends se{constructor(e){super(),ie(this,e,Tt,Lt,oe,{slot:0,selectedLayer:1,selectedSlot:2})}}function Ve(n){let e,r,t;const s=[{texture:n[1]},n[2]];function l(a){n[7](a)}let o={};for(let a=0;a<s.length;a+=1)o=ce(o,s[a]);return n[0]!==void 0&&(o.instance=n[0]),e=new G({props:o}),j.push(()=>ee(e,"instance",l)),{c(){R(e.$$.fragment)},m(a,f){D(e,a,f),t=!0},p(a,f){const i=f&6?be(s,[f&2&&{texture:a[1]},f&4&&ke(a[2])]):{};!r&&f&1&&(r=!0,i.instance=a[0],te(()=>r=!1)),e.$set(i)},i(a){t||(y(e.$$.fragment,a),t=!0)},o(a){E(e.$$.fragment,a),t=!1},d(a){Q(e,a)}}}function Nt(n){let e,r,t=n[1]&&Ve(n);return{c(){t&&t.c(),e=fe()},m(s,l){t&&t.m(s,l),V(s,e,l),r=!0},p(s,[l]){s[1]?t?(t.p(s,l),l&2&&y(t,1)):(t=Ve(s),t.c(),y(t,1),t.m(e.parentNode,e)):t&&(ne(),E(t,1,1,()=>{t=null}),re())},i(s){r||(y(t),r=!0)},o(s){E(t),r=!1},d(s){t&&t.d(s),s&&F(e)}}}function Vt(n,e,r){const t=["width","height","texture","instance"];let s=We(e,t),{width:l}=e,{height:o}=e,{texture:a}=e,{instance:f=void 0}=e,i={width:-1,height:-1},u;function m(c){f=c,r(0,f)}return n.$$set=c=>{e=ce(ce({},e),at(c)),r(2,s=We(e,t)),"width"in c&&r(3,l=c.width),"height"in c&&r(4,o=c.height),"texture"in c&&r(5,a=c.texture),"instance"in c&&r(0,f=c.instance)},n.$$.update=()=>{if(n.$$.dirty&120&&a&&!me.isEqual(i,{width:l,height:o})){r(6,i={width:l,height:o});let{app:c}=Ce(),S=new ue(a);S.width=l,S.height=o,r(1,u=c.renderer.generateTexture(S,{scaleMode:ge.LINEAR,region:new he(0,0,l,o)}))}},[f,u,s,l,o,a,i,m]}class Ft extends se{constructor(e){super(),ie(this,e,Vt,Nt,oe,{width:3,height:4,texture:5,instance:0})}}function Bt(n){let e,r;return e=new G({props:{texture:n[5]}}),{c(){R(e.$$.fragment)},m(t,s){D(e,t,s),r=!0},p(t,s){const l={};s&32&&(l.texture=t[5]),e.$set(l)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){Q(e,t)}}}function Rt(n){let e,r;return e=new ye({props:{$$slots:{default:[Dt]},$$scope:{ctx:n}}}),{c(){R(e.$$.fragment)},m(t,s){D(e,t,s),r=!0},p(t,s){const l={};s&16415&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){Q(e,t)}}}function Dt(n){let e,r,t,s,l,o;e=new G({props:{texture:n[3]}});const a=[{texture:n[2]},n[0].layers[n[1]].pos];let f={};for(let i=0;i<a.length;i+=1)f=ce(f,a[i]);return t=new G({props:f}),l=new G({props:{texture:n[4]}}),{c(){R(e.$$.fragment),r=N(),R(t.$$.fragment),s=N(),R(l.$$.fragment)},m(i,u){D(e,i,u),V(i,r,u),D(t,i,u),V(i,s,u),D(l,i,u),o=!0},p(i,u){const m={};u&8&&(m.texture=i[3]),e.$set(m);const c=u&7?be(a,[u&4&&{texture:i[2]},u&3&&ke(i[0].layers[i[1]].pos)]):{};t.$set(c);const S={};u&16&&(S.texture=i[4]),l.$set(S)},i(i){o||(y(e.$$.fragment,i),y(t.$$.fragment,i),y(l.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(t.$$.fragment,i),E(l.$$.fragment,i),o=!1},d(i){Q(e,i),i&&F(r),Q(t,i),i&&F(s),Q(l,i)}}}function Qt(n){let e,r,t,s;const l=[Rt,Bt],o=[];function a(f,i){return f[4]&&f[3]&&f[2]?0:f[5]?1:-1}return~(e=a(n))&&(r=o[e]=l[e](n)),{c(){r&&r.c(),t=fe()},m(f,i){~e&&o[e].m(f,i),V(f,t,i),s=!0},p(f,[i]){let u=e;e=a(f),e===u?~e&&o[e].p(f,i):(r&&(ne(),E(o[u],1,1,()=>{o[u]=null}),re()),~e?(r=o[e],r?r.p(f,i):(r=o[e]=l[e](f),r.c()),y(r,1),r.m(t.parentNode,t)):r=null)},i(f){s||(y(r),s=!0)},o(f){E(r),s=!1},d(f){~e&&o[e].d(f),f&&F(t)}}}function Jt(n,e,r){let t,{renderSlot:s}=e,{selectedLayer:l}=e,o={},a=new WeakMap,f={width:-1,height:-1},i,{app:u}=Ce(),m,c,S,p;function L(h){if(!a.has(h.image)){let A=new x(new we(h.image)),_=new ue(A);_.x=h.pos.x,_.y=h.pos.y,_.width=h.rect.width,_.height=h.rect.height,a.set(h.image,u.renderer.generateTexture(_,{scaleMode:ge.LINEAR,region:new he(0,0,117,166),multisample:kt.HIGH}))}return a.get(h.image)}function g(h){let A=new tt;for(let _ of[...h].reverse())A.addChild(new ue(L(_)));return u.renderer.generateTexture(A,{scaleMode:ge.NEAREST,region:new he(0,0,117,166)})}return n.$$set=h=>{"renderSlot"in h&&r(0,s=h.renderSlot),"selectedLayer"in h&&r(1,l=h.selectedLayer)},n.$$.update=()=>{if(n.$$.dirty&3&&r(9,t=l!==void 0?s.layers[l].rect:void 0),n.$$.dirty&3&&l!==void 0&&(a.delete(s.layers[l].image),r(7,f={width:-1,height:-1}),r(2,i=void 0)),n.$$.dirty&67&&(me.isEqual(o,{selected:l,layers:s.layers.map(h=>h.image.src)})||(r(6,o={selected:l,layers:s.layers.map(h=>h.image.src)}),r(8,p=l!==void 0?new x(new we(s.layers[l].image)):void 0),r(3,m=l!==void 0?g(s.layers.slice(l+1)):void 0),r(4,c=l!==void 0?g(s.layers.slice(0,l)):void 0),r(5,S=l===void 0?g(s.layers):void 0))),n.$$.dirty&896&&p&&!me.isEqual(f,t)){r(7,f={...t});let h=new ue(p);h.width=f.width,h.height=f.height,r(2,i=u.renderer.generateTexture(h,{scaleMode:ge.NEAREST,region:new he(0,0,f.width,f.height)}))}},[s,l,i,m,c,S,o,f,p,t]}class Ht extends se{constructor(e){super(),ie(this,e,Jt,Qt,oe,{renderSlot:0,selectedLayer:1})}}const Ot=n=>({fonts:n&1}),Fe=n=>({fonts:n[0]});function Pt(n){return{c:P,m:P,p:P,i:P,o:P,d:P}}function Yt(n){let e;const r=n[3].default,t=ct(r,n,n[2],Fe);return{c(){t&&t.c()},m(s,l){t&&t.m(s,l),e=!0},p(s,l){t&&t.p&&(!e||l&5)&&gt(t,r,s,s[2],e?pt(r,s[2],l,Ot):ht(s[2]),Fe)},i(s){e||(y(t,s),e=!0)},o(s){E(t,s),e=!1},d(s){t&&t.d(s)}}}function Kt(n){return{c:P,m:P,p:P,i:P,o:P,d:P}}function jt(n){let e,r,t,s={ctx:n,current:null,token:null,hasCatch:!1,pending:Kt,then:Yt,catch:Pt,blocks:[,,,]};return Le(r=n[1],s),{c(){e=fe(),s.block.c()},m(l,o){V(l,e,o),s.block.m(l,s.anchor=o),s.mount=()=>e.parentNode,s.anchor=e,t=!0},p(l,[o]){n=l,s.ctx=n,o&2&&r!==(r=n[1])&&Le(r,s)||ut(s,n,o)},i(l){t||(y(s.block),t=!0)},o(l){for(let o=0;o<3;o+=1){const a=s.blocks[o];E(a)}t=!1},d(l){l&&F(e),s.block.d(l),s.token=null,s=null}}}function Xt(n,e,r){let t,{$$slots:s={},$$scope:l}=e,{fonts:o}=e;return n.$$set=a=>{"fonts"in a&&r(0,o=a.fonts),"$$scope"in a&&r(2,l=a.$$scope)},n.$$.update=()=>{n.$$.dirty&1&&r(1,t=Promise.all(o.map(a=>new dt(a).load())))},[o,t,l,s]}class Zt extends se{constructor(e){super(),ie(this,e,Xt,jt,oe,{fonts:0})}}function Be(n){let e,r;return e=new G({props:{texture:n[3],x:n[0],y:n[1],anchor:n[2]}}),{c(){R(e.$$.fragment)},m(t,s){D(e,t,s),r=!0},p(t,s){const l={};s&8&&(l.texture=t[3]),s&1&&(l.x=t[0]),s&2&&(l.y=t[1]),s&4&&(l.anchor=t[2]),e.$set(l)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){Q(e,t)}}}function Gt(n){let e,r,t=n[3]&&Be(n);return{c(){t&&t.c(),e=fe()},m(s,l){t&&t.m(s,l),V(s,e,l),r=!0},p(s,[l]){s[3]?t?(t.p(s,l),l&8&&y(t,1)):(t=Be(s),t.c(),y(t,1),t.m(e.parentNode,e)):t&&(ne(),E(t,1,1,()=>{t=null}),re())},i(s){r||(y(t),r=!0)},o(s){E(t),r=!1},d(s){t&&t.d(s),s&&F(e)}}}function xt(n,e,r){let{text:t}=e,{style:s={}}=e,{maxWidth:l}=e,{maxHeight:o}=e,{x:a=0}=e,{y:f=0}=e,{anchor:i=0}=e,u,m={};function c(p,L){let g=new Te(p);g.wordWrapWidth=L;let h=At.measureText(t,g,g.wordWrap),A=1;return h.width>l&&(A=l/h.width),h.height*A>o&&(A*=o/(h.height*A)),A}function S(){r(8,m={text:t,style:s});let{app:p}=Ce(),L=new Te({...s,wordWrap:!0,wordWrapWidth:l}),g=c(L,l);if(g<1){let A=l,_=l/g;for(g=c(L,_);;){let v=(A+_)/2,B=c(L,v);if(B>g){_=v,g=B;continue}let W=_+(v-A),C=c(L,W);if(C>g){A=_,_=W,g=C;continue}break}L.wordWrapWidth=_}let h=new yt(t,L);return h.width*=g,h.height*=g,p.renderer.generateTexture(h,{region:new he(0,0,h.width,h.height)})}return n.$$set=p=>{"text"in p&&r(4,t=p.text),"style"in p&&r(5,s=p.style),"maxWidth"in p&&r(6,l=p.maxWidth),"maxHeight"in p&&r(7,o=p.maxHeight),"x"in p&&r(0,a=p.x),"y"in p&&r(1,f=p.y),"anchor"in p&&r(2,i=p.anchor)},n.$$.update=()=>{n.$$.dirty&304&&(me.isEqual(m,{text:t,style:s})||r(3,u=S()))},[a,f,i,u,t,s,l,o,m]}class $t extends se{constructor(e){super(),ie(this,e,xt,Gt,oe,{text:4,style:5,maxWidth:6,maxHeight:7,x:0,y:1,anchor:2})}}function Re(n,e,r){const t=n.slice();return t[21]=e[r],t[23]=r,t}function De(n,e,r){const t=n.slice();return t[24]=e[r],t[23]=r,t}function Ae(n){const e=n.slice(),r=e[3][e[0]];e[21]=r;const t=e[21].layers[e[4]];return e[24]=t,e}function Qe(n,e,r){const t=n.slice();return t[21]=e[r],t}function Je(n,e,r){const t=n.slice();return t[21]=e[r],t[28]=e,t[23]=r,t}function en(n){let e,r,t,s,l,o,a;function f(u){n[8](u,n[23])}let i={texture:x.from(Ee),x:-2,y:-2};return n[2][n[23]]!==void 0&&(i.instance=n[2][n[23]]),e=new G({props:i}),j.push(()=>ee(e,"instance",f)),s=new G({props:{texture:x.WHITE,filters:[new _e(Se(n[21].background))],width:117,height:166}}),o=new Ht({props:{renderSlot:n[21],selectedLayer:n[0]===n[23]?n[4]:void 0}}),{c(){R(e.$$.fragment),t=N(),R(s.$$.fragment),l=N(),R(o.$$.fragment)},m(u,m){D(e,u,m),V(u,t,m),D(s,u,m),V(u,l,m),D(o,u,m),a=!0},p(u,m){n=u;const c={};!r&&m&12&&(r=!0,c.instance=n[2][n[23]],te(()=>r=!1)),e.$set(c);const S={};m&8&&(S.filters=[new _e(Se(n[21].background))]),s.$set(S);const p={};m&8&&(p.renderSlot=n[21]),m&25&&(p.selectedLayer=n[0]===n[23]?n[4]:void 0),o.$set(p)},i(u){a||(y(e.$$.fragment,u),y(s.$$.fragment,u),y(o.$$.fragment,u),a=!0)},o(u){E(e.$$.fragment,u),E(s.$$.fragment,u),E(o.$$.fragment,u),a=!1},d(u){Q(e,u),u&&F(t),Q(s,u),u&&F(l),Q(o,u)}}}function He(n,e){let r,t,s;const l=[{mask:e[2][e[23]]},e[21].pos];let o={$$slots:{default:[en]},$$scope:{ctx:e}};for(let a=0;a<l.length;a+=1)o=ce(o,l[a]);return t=new ye({props:o}),{key:n,first:null,c(){r=fe(),R(t.$$.fragment),this.first=r},m(a,f){V(a,r,f),D(t,a,f),s=!0},p(a,f){e=a;const i=f&12?be(l,[{mask:e[2][e[23]]},f&8&&ke(e[21].pos)]):{};f&536870941&&(i.$$scope={dirty:f,ctx:e}),t.$set(i)},i(a){s||(y(t.$$.fragment,a),s=!0)},o(a){E(t.$$.fragment,a),s=!1},d(a){a&&F(r),Q(t,a)}}}function Oe(n){let e,r;return e=new ye({props:{x:n[21].pos.x+1,y:n[21].pos.y+167,$$slots:{default:[tn]},$$scope:{ctx:n}}}),{c(){R(e.$$.fragment)},m(t,s){D(e,t,s),r=!0},p(t,s){const l={};s&8&&(l.x=t[21].pos.x+1),s&8&&(l.y=t[21].pos.y+167),s&536870920&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){Q(e,t)}}}function tn(n){let e,r,t,s;return e=new G({props:{texture:x.from(lt)}}),t=new $t({props:{text:n[21].dynamic.trim(),style:{fill:0,breakWords:!0,fontFamily:["Noto Sans TC","Noto Sans SC","Noto Sans JP","sans-serif"],fontSize:15,align:"center",textBaseline:"alphabetic"},anchor:.5,x:56,y:14,maxWidth:110,maxHeight:26}}),{c(){R(e.$$.fragment),r=N(),R(t.$$.fragment)},m(l,o){D(e,l,o),V(l,r,o),D(t,l,o),s=!0},p(l,o){const a={};o&8&&(a.text=l[21].dynamic.trim()),t.$set(a)},i(l){s||(y(e.$$.fragment,l),y(t.$$.fragment,l),s=!0)},o(l){E(e.$$.fragment,l),E(t.$$.fragment,l),s=!1},d(l){Q(e,l),l&&F(r),Q(t,l)}}}function Pe(n){var s;let e,r,t=((s=n[21].dynamic)==null?void 0:s.length)&&Oe(n);return{c(){t&&t.c(),e=fe()},m(l,o){t&&t.m(l,o),V(l,e,o),r=!0},p(l,o){var a;(a=l[21].dynamic)!=null&&a.length?t?(t.p(l,o),o&8&&y(t,1)):(t=Oe(l),t.c(),y(t,1),t.m(e.parentNode,e)):t&&(ne(),E(t,1,1,()=>{t=null}),re())},i(l){r||(y(t),r=!0)},o(l){E(t),r=!1},d(l){t&&t.d(l),l&&F(e)}}}function Ye(n){let e,r,t,s;e=new G({props:{texture:x.WHITE,width:680,height:680,filters:[new _e(0)]}});const l=[{texture:new x(new we(n[24].image))},{alpha:.75},{x:n[21].pos.x+n[24].pos.x},{y:n[21].pos.y+n[24].pos.y},n[24].rect];let o={};for(let a=0;a<l.length;a+=1)o=ce(o,l[a]);return t=new Ft({props:o}),{c(){R(e.$$.fragment),r=N(),R(t.$$.fragment)},m(a,f){D(e,a,f),V(a,r,f),D(t,a,f),s=!0},p(a,f){const i=f&25?be(l,[{texture:new x(new we(a[24].image))},l[1],f&25&&{x:a[21].pos.x+a[24].pos.x},f&25&&{y:a[21].pos.y+a[24].pos.y},f&25&&ke(a[24].rect)]):{};t.$set(i)},i(a){s||(y(e.$$.fragment,a),y(t.$$.fragment,a),s=!0)},o(a){E(e.$$.fragment,a),E(t.$$.fragment,a),s=!1},d(a){Q(e,a),a&&F(r),Q(t,a)}}}function nn(n){let e,r,t=n[0]!==void 0&&n[4]!==void 0&&Ye(Ae(n));return{c(){t&&t.c(),e=fe()},m(s,l){t&&t.m(s,l),V(s,e,l),r=!0},p(s,l){s[0]!==void 0&&s[4]!==void 0?t?(t.p(Ae(s),l),l&17&&y(t,1)):(t=Ye(Ae(s)),t.c(),y(t,1),t.m(e.parentNode,e)):t&&(ne(),E(t,1,1,()=>{t=null}),re())},i(s){r||(y(t),r=!0)},o(s){E(t),r=!1},d(s){t&&t.d(s),s&&F(e)}}}function rn(n){let e,r,t=[],s=new Map,l,o,a,f,i,u;e=new G({props:{texture:x.WHITE,width:680,height:680}});let m=n[3];const c=g=>g[21];for(let g=0;g<m.length;g+=1){let h=Je(n,m,g),A=c(h);s.set(A,t[g]=He(A,h))}o=new G({props:{texture:x.from(rt),width:680,height:680}});let S=n[3],p=[];for(let g=0;g<S.length;g+=1)p[g]=Pe(Qe(n,S,g));const L=g=>E(p[g],1,1,()=>{p[g]=null});return i=new ye({props:{mask:n[5],alpha:.8,$$slots:{default:[nn]},$$scope:{ctx:n}}}),{c(){R(e.$$.fragment),r=N();for(let g=0;g<t.length;g+=1)t[g].c();l=N(),R(o.$$.fragment),a=N();for(let g=0;g<p.length;g+=1)p[g].c();f=N(),R(i.$$.fragment)},m(g,h){D(e,g,h),V(g,r,h);for(let A=0;A<t.length;A+=1)t[A].m(g,h);V(g,l,h),D(o,g,h),V(g,a,h);for(let A=0;A<p.length;A+=1)p[A].m(g,h);V(g,f,h),D(i,g,h),u=!0},p(g,h){if(h&29&&(m=g[3],ne(),t=ve(t,h,c,1,g,m,s,l.parentNode,bt,He,l,Je),re()),h&8){S=g[3];let _;for(_=0;_<S.length;_+=1){const v=Qe(g,S,_);p[_]?(p[_].p(v,h),y(p[_],1)):(p[_]=Pe(v),p[_].c(),y(p[_],1),p[_].m(f.parentNode,f))}for(ne(),_=S.length;_<p.length;_+=1)L(_);re()}const A={};h&32&&(A.mask=g[5]),h&536870937&&(A.$$scope={dirty:h,ctx:g}),i.$set(A)},i(g){if(!u){y(e.$$.fragment,g);for(let h=0;h<m.length;h+=1)y(t[h]);y(o.$$.fragment,g);for(let h=0;h<S.length;h+=1)y(p[h]);y(i.$$.fragment,g),u=!0}},o(g){E(e.$$.fragment,g);for(let h=0;h<t.length;h+=1)E(t[h]);E(o.$$.fragment,g),p=p.filter(Boolean);for(let h=0;h<p.length;h+=1)E(p[h]);E(i.$$.fragment,g),u=!1},d(g){Q(e,g),g&&F(r);for(let h=0;h<t.length;h+=1)t[h].d(g);g&&F(l),Q(o,g),g&&F(a),et(p,g),g&&F(f),Q(i,g)}}}function ln(n){let e,r;return e=new Zt({props:{fonts:["Noto Sans TC","Noto Sans SC","Noto Sans JP"],$$slots:{default:[rn]},$$scope:{ctx:n}}}),{c(){R(e.$$.fragment)},m(t,s){D(e,t,s),r=!0},p(t,s){const l={};s&536870973&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){Q(e,t)}}}function sn(n){let e,r;return e=new _t({props:{resources:[rt,Ee,lt],$$slots:{default:[ln]},$$scope:{ctx:n}}}),{c(){R(e.$$.fragment)},m(t,s){D(e,t,s),r=!0},p(t,s){const l={};s&536870973&&(l.$$scope={dirty:s,ctx:t}),e.$set(l)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){E(e.$$.fragment,t),r=!1},d(t){Q(e,t)}}}function on(n){let e=[],r=new Map,t,s,l,o=[...n[21].layers].reverse();const a=i=>i[24].image;for(let i=0;i<o.length;i+=1){let u=De(n,o,i),m=a(u);r.set(m,e[i]=Ke(m,u))}let f=n[4]!==void 0&&je(n);return{c(){for(let i=0;i<e.length;i+=1)e[i].c();t=N(),f&&f.c(),s=fe()},m(i,u){for(let m=0;m<e.length;m+=1)e[m].m(i,u);V(i,t,u),f&&f.m(i,u),V(i,s,u),l=!0},p(i,u){u&24&&(o=[...i[21].layers].reverse(),e=ve(e,u,a,1,i,o,r,t.parentNode,$e,Ke,t,De)),i[4]!==void 0?f?(f.p(i,u),u&16&&y(f,1)):(f=je(i),f.c(),y(f,1),f.m(s.parentNode,s)):f&&(ne(),E(f,1,1,()=>{f=null}),re())},i(i){l||(y(f),l=!0)},o(i){E(f),l=!1},d(i){for(let u=0;u<e.length;u+=1)e[u].d(i);i&&F(t),f&&f.d(i),i&&F(s)}}}function fn(n){let e,r,t;function s(){return n[10](n[23])}return{c(){e=q("button"),z(e,"class","block h-full w-full")},m(l,o){V(l,e,o),r||(t=J(e,"click",s),r=!0)},p(l,o){n=l},i:P,o:P,d(l){l&&F(e),r=!1,t()}}}function Ke(n,e){let r,t,s;function l(){return e[11](e[21],e[23])}return{key:n,first:null,c(){r=q("div"),z(r,"class","absolute z-10"),U(r,"top",e[24].pos.y+"px"),U(r,"left",e[24].pos.x+"px"),U(r,"width",e[24].rect.width+"px"),U(r,"height",e[24].rect.height+"px"),this.first=r},m(o,a){V(o,r,a),t||(s=J(r,"mousedown",l),t=!0)},p(o,a){e=o,a&8&&U(r,"top",e[24].pos.y+"px"),a&8&&U(r,"left",e[24].pos.x+"px"),a&8&&U(r,"width",e[24].rect.width+"px"),a&8&&U(r,"height",e[24].rect.height+"px")},d(o){o&&F(r),t=!1,s()}}}function je(n){let e,r,t,s,l,o;function a(c){n[12](c)}function f(c){n[13](c)}function i(c){n[14](c)}function u(c){n[15](c)}let m={ratio:n[3][n[0]].layers[n[4]].image.width/n[3][n[0]].layers[n[4]].image.height};return n[3][n[0]].layers[n[4]].pos.x!==void 0&&(m.x=n[3][n[0]].layers[n[4]].pos.x),n[3][n[0]].layers[n[4]].pos.y!==void 0&&(m.y=n[3][n[0]].layers[n[4]].pos.y),n[3][n[0]].layers[n[4]].rect.width!==void 0&&(m.width=n[3][n[0]].layers[n[4]].rect.width),n[3][n[0]].layers[n[4]].rect.height!==void 0&&(m.height=n[3][n[0]].layers[n[4]].rect.height),e=new It({props:m}),j.push(()=>ee(e,"x",a)),j.push(()=>ee(e,"y",f)),j.push(()=>ee(e,"width",i)),j.push(()=>ee(e,"height",u)),{c(){R(e.$$.fragment)},m(c,S){D(e,c,S),o=!0},p(c,S){const p={};S&25&&(p.ratio=c[3][c[0]].layers[c[4]].image.width/c[3][c[0]].layers[c[4]].image.height),!r&&S&25&&(r=!0,p.x=c[3][c[0]].layers[c[4]].pos.x,te(()=>r=!1)),!t&&S&25&&(t=!0,p.y=c[3][c[0]].layers[c[4]].pos.y,te(()=>t=!1)),!s&&S&25&&(s=!0,p.width=c[3][c[0]].layers[c[4]].rect.width,te(()=>s=!1)),!l&&S&25&&(l=!0,p.height=c[3][c[0]].layers[c[4]].rect.height,te(()=>l=!1)),e.$set(p)},i(c){o||(y(e.$$.fragment,c),o=!0)},o(c){E(e.$$.fragment,c),o=!1},d(c){Q(e,c)}}}function Xe(n){let e,r,t,s,l;const o=[fn,on],a=[];function f(i,u){return i[0]!==i[23]?0:1}return r=f(n),t=a[r]=o[r](n),{c(){e=q("div"),t.c(),s=N(),z(e,"class","slot svelte-p2cpum"),U(e,"left",n[21].pos.x+"px"),U(e,"top",n[21].pos.y+"px"),M(e,"outline",n[0]===n[23])},m(i,u){V(i,e,u),a[r].m(e,null),b(e,s),l=!0},p(i,u){let m=r;r=f(i),r===m?a[r].p(i,u):(ne(),E(a[m],1,1,()=>{a[m]=null}),re(),t=a[r],t?t.p(i,u):(t=a[r]=o[r](i),t.c()),y(t,1),t.m(e,s)),(!l||u&8)&&U(e,"left",i[21].pos.x+"px"),(!l||u&8)&&U(e,"top",i[21].pos.y+"px"),(!l||u&1)&&M(e,"outline",i[0]===i[23])},i(i){l||(y(t),l=!0)},o(i){E(t),l=!1},d(i){i&&F(e),a[r].d()}}}function Ze(n){let e,r,t,s,l;function o(u){n[16](u)}function a(u){n[17](u)}function f(u){n[18](u)}let i={};return n[3][n[0]]!==void 0&&(i.slot=n[3][n[0]]),n[4]!==void 0&&(i.selectedLayer=n[4]),n[0]!==void 0&&(i.selectedSlot=n[0]),e=new Ut({props:i}),j.push(()=>ee(e,"slot",o)),j.push(()=>ee(e,"selectedLayer",a)),j.push(()=>ee(e,"selectedSlot",f)),{c(){R(e.$$.fragment)},m(u,m){D(e,u,m),l=!0},p(u,m){const c={};!r&&m&9&&(r=!0,c.slot=u[3][u[0]],te(()=>r=!1)),!t&&m&16&&(t=!0,c.selectedLayer=u[4],te(()=>t=!1)),!s&&m&1&&(s=!0,c.selectedSlot=u[0],te(()=>s=!1)),e.$set(c)},i(u){l||(y(e.$$.fragment,u),l=!0)},o(u){E(e.$$.fragment,u),l=!1},d(u){Q(e,u)}}}function an(n){let e,r,t,s,l,o,a,f,i,u,m,c,S,p,L,g;function h(C){n[9](C)}let A={width:680,height:680,backgroundColor:n[6],antialias:!0,render:"demand",$$slots:{default:[sn]},$$scope:{ctx:n}};n[1]!==void 0&&(A.instance=n[1]),s=new mt({props:A}),j.push(()=>ee(s,"instance",h));let _=n[3],v=[];for(let C=0;C<_.length;C+=1)v[C]=Xe(Re(n,_,C));const B=C=>E(v[C],1,1,()=>{v[C]=null});let W=n[0]!==void 0&&Ze(n);return{c(){e=q("div"),r=q("div"),t=q("div"),R(s.$$.fragment),o=N();for(let C=0;C<v.length;C+=1)v[C].c();a=N(),f=q("div"),i=q("button"),i.textContent="導出",u=N(),m=q("div"),W&&W.c(),c=N(),S=q("div"),S.innerHTML=`<p>Credit: <a class="text-blue-700" target="_blank" rel="noreferrer" href="https://twitter.com/EastAiruier/status/1624174786359496704">@EastAiruier</a></p> 
            <p class="mt-2">代碼: <a href="https://github.com/eslym/vtuber-preference" class="text-blue-700" target="_blank" rel="noreferrer">eslym/vtuber-preference</a></p>`,z(t,"class","template svelte-p2cpum"),z(r,"class","flex flex-grow flex-row items-center justify-center overflow-hidden shadow-lg"),z(i,"class","bg-slate-400 p-2 text-center text-lg font-bold text-white"),z(m,"class","h-0 flex-grow"),z(S,"class","py-2 text-center text-sm italic"),z(f,"class","flex h-full w-80 flex-col overflow-auto border-slate-200 bg-white shadow"),z(e,"class","flex h-screen w-screen flex-row bg-opacity-90"),M(e,"bg-black",n[0]!==void 0&&n[4]!==void 0)},m(C,d){V(C,e,d),b(e,r),b(r,t),D(s,t,null),b(t,o);for(let w=0;w<v.length;w+=1)v[w].m(t,null);b(e,a),b(e,f),b(f,i),b(f,u),b(f,m),W&&W.m(m,null),b(f,c),b(f,S),p=!0,L||(g=J(i,"click",n[7]),L=!0)},p(C,[d]){const w={};if(d&536870973&&(w.$$scope={dirty:d,ctx:C}),!l&&d&2&&(l=!0,w.instance=C[1],te(()=>l=!1)),s.$set(w),d&25){_=C[3];let I;for(I=0;I<_.length;I+=1){const H=Re(C,_,I);v[I]?(v[I].p(H,d),y(v[I],1)):(v[I]=Xe(H),v[I].c(),y(v[I],1),v[I].m(t,null))}for(ne(),I=_.length;I<v.length;I+=1)B(I);re()}C[0]!==void 0?W?(W.p(C,d),d&1&&y(W,1)):(W=Ze(C),W.c(),y(W,1),W.m(m,null)):W&&(ne(),E(W,1,1,()=>{W=null}),re()),(!p||d&17)&&M(e,"bg-black",C[0]!==void 0&&C[4]!==void 0)},i(C){if(!p){y(s.$$.fragment,C);for(let d=0;d<_.length;d+=1)y(v[d]);y(W),p=!0}},o(C){E(s.$$.fragment,C),v=v.filter(Boolean);for(let d=0;d<v.length;d+=1)E(v[d]);E(W),p=!1},d(C){C&&F(e),Q(s),et(v,C),W&&W.d(),L=!1,g()}}}function un(n,e,r){let t,s=[],l=[],o=[{name:"第一個看的",background:"#ffffff",pos:{x:48,y:48},layers:[]},{name:"最常看的",background:"#ffffff",pos:{x:166,y:48},layers:[]},{name:"最佳節目",background:"#ffffff",pos:{x:283,y:48},layers:[]},{name:"最瘋狂的",background:"#ffffff",pos:{x:401,y:48},layers:[]},{name:"最療愈的",background:"#ffffff",pos:{x:519,y:48},layers:[]},{name:"聲音最好聽的",background:"#ffffff",pos:{x:48,y:248},layers:[]},{name:"唱歌最好聽的",background:"#ffffff",pos:{x:166,y:248},layers:[]},{name:"最喜歡的",background:"#ffffff",pos:{x:283,y:248},layers:[]},{name:"影響最深遠的",background:"#ffffff",pos:{x:401,y:248},layers:[]},{name:"最漂亮的",background:"#ffffff",pos:{x:519,y:248},layers:[]},{name:"最想犯罪的",background:"#ffffff",pos:{x:48,y:448},layers:[]},{name:"最帥的",background:"#ffffff",pos:{x:166,y:448},layers:[]},{name:"最想推廣的",background:"#ffffff",pos:{x:283,y:448},layers:[]},{name:"最婆的",background:"#ffffff",pos:{x:401,y:448},layers:[]},{name:"自定义",background:"#ffffff",pos:{x:519,y:448},layers:[]}];const a=Se("#ffffff");let f,i,u;function m(){if(!l[f]){let d=o[f],w=new tt,I=w.addChild(new ue(x.WHITE));I.width=680,I.height=680;let H=w.addChild(new ue(x.from(Ee)));H.filters=[new _e(0)],H.x=d.pos.x-2,H.y=d.pos.y-2,l[f]=new ue(u.renderer.generateTexture(w))}return l[f]}async function c(){r(4,i=void 0),await wt();let w=new St(u.renderer).base64(u.stage,"image/jpeg"),I=document.createElement("a");I.download="output.jpg",I.href=w,I.click()}function S(d,w){n.$$.not_equal(s[w],d)&&(s[w]=d,r(2,s))}function p(d){u=d,r(1,u)}const L=d=>{r(0,f=d),r(4,i=void 0)},g=(d,w)=>r(4,i=d.layers.length-w-1);function h(d){n.$$.not_equal(o[f].layers[i].pos.x,d)&&(o[f].layers[i].pos.x=d,r(3,o))}function A(d){n.$$.not_equal(o[f].layers[i].pos.y,d)&&(o[f].layers[i].pos.y=d,r(3,o))}function _(d){n.$$.not_equal(o[f].layers[i].rect.width,d)&&(o[f].layers[i].rect.width=d,r(3,o))}function v(d){n.$$.not_equal(o[f].layers[i].rect.height,d)&&(o[f].layers[i].rect.height=d,r(3,o))}function B(d){n.$$.not_equal(o[f],d)&&(o[f]=d,r(3,o))}function W(d){i=d,r(4,i)}function C(d){f=d,r(0,f)}return n.$$.update=()=>{n.$$.dirty&3&&r(5,t=u&&f!==void 0?m():null)},[f,u,s,o,i,t,a,c,S,p,L,g,h,A,_,v,B,W,C]}class dn extends se{constructor(e){super(),ie(this,e,un,an,oe,{})}}nt.SCALE_MODE=ge.LINEAR;nt.MIPMAP_TEXTURES=zt.ON;new dn({target:document.body});window.PIXI=vt;
